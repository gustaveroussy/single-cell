Materials and Methods


Integration analysis
Datasets were integrated using canonical correlation analysis (CCA) to identify pairwise anchors between datasets and using the anchors to harmonize the datasets, as implemented in Seurat (version 4.0.1).In practice, datasets were normalized independently using SCTransform, as described before (see Individual Analysis section). The top 3000 Highly Variable Genes across all samples were selected by the SelectIntegrationFeatures() function and used for integration with the PrepSCTIntegration(), FindIntegrationAnchors() and IntegrateData() functions (with default parameters). After integration, a  PCA  dimension reduction was performed on integrated dataset.The number of PCA dimensions to keep for further analysis was evaluated by assessing a range of reduced PCA spaces using 3 to 49 dimensions, with a step of 2. For each generated PCA space, Louvain clustering of cells was performed using a range of values for the resolution parameter from 0.1 to 1.2 with a step of 0.1. The optimal space was manually evaluated as the one combination of kept dimensions and clustering resolution resolving the best structure (clusters homogeneity and compacity) in a Uniform Manifold Approximation and Projection space (UMAP). Additionaly, we used the clustree method (version 0.4.3) to assess if the selected optimal space corresponded to a relatively stable position in the clustering results tested for these dimensions / resolution combinations.
An automatic annotation of cell types was perfom by SingleR (version 1.4.1) (with fine-tuning step) and ClustifyR (version 1.3.3), using packages built-in references. It labels clusters (or cells) from a dataset based on similarity (Spearman correlation score) to a reference dataset with known labels. The labels with a correlation score greater than 0.25 for SingleR or greater than 0.35 for ClustifyR were kept.Marker genes for Louvain clusters and samples, were identified through a «one versus others» differential anaylisis using the Wilcoxon test through the FindAllMarkers() function from Seurat, considering only genes with a minimum log fold-change of 0.5 in at least 75% of cells from one of the groups compared, and FDR-adjusted p-values <0.05 (Benjaminin-Hochberg method).

Cell surface proteins (CITE-seq ADT)
Raw BCL-files were demultiplexed and converted to Fastq format using bcl2fastq (version 2.20.0.422 from Illumina).Reads quality control was performed using fastqc (version 0.11.9) and assignment to the expected genome species evaluated with fastq-screen (version 0.14.0).A customized index, with the correspondance between synthetic DNA-transcripts and tagged protein names, was made with the kb-python (version 0.24.4) wrapper of kallisto. Reads were pseudo-mapped to the customized index with kallisto (version 0.46.2) using its 'bus' subcommand and parameters corresponding to the 10X Chromium 5' scRNA-Seq v2 chemistry. Barcode correction using whitelist provided by the manufacturer (10X Genomics) and gene-based reads quantification was performed with BUStools (version 0.40.0). Only cell barcodes corresponding to the cell barcodes of gene expression were kept. Counting table was log-normalize (NormalizeData() function from Seurat with normalization.method parameters setting to 'LogNormalize') and spearman correlation scores beetween proteins levels and genes expression levels was computed and ploted on UMAP.

Single-cell immune profiling (TCR/Ig)
Raw BCL-files were demultiplexed and converted to Fastq format using bcl2fastq (version 2.20.0.422 from Illumina).Reads quality control was performed using fastqc (version 0.11.9) and assignment to the expected genome species evaluated with fastq-screen (version 0.14.0).CellRanger (version 3.1.0 from 10X Genomics) was used to generate single-cell V(D)J sequences and annotations. The annotation was merged with corresponding cell barcode of gene expression. The scRepertoire package (version 1.1.2) was used to process annotation to assign clonotype based on TCR or Ig chains. scRepertoire allows to study contig quantification, contig abundance, contig length, clonal space homeostasis, clonal proportion, clonal overlap beetween clusters and diversity. Physicochemical properties of the CDR3, based on amino-acid sequences, was determined by the alakazam R package (version 1.1.0).

Cerebro
Cerebro (version 1.3.1), cell report browser, is an AppShiny which allows users to interactively visualize various parts of single cell transcriptomics analysis without requiring bioinformatics expertise. This package is also used to identify most expressed genes, and to compute pathway enrichment on marker genes (based on the Enrichr API) and Gene Set Enrichment Analysis (uses the Gene Set Variation Analysis method in combination with additional statistics as published by Diaz-Mejia et. al.(Diaz-Mejia JJ, Meng EC, Pico AR et al. Evaluation of methods to assign cell type labels to cell clusters from single-cell RNA-sequencing data [version 3; peer review: 2 approved, 1 approved with reservations]. F1000Research 2019, 8(ISCB Comm J):296 (https://doi.org/10.12688/f1000research.18490.3))) from the MSigDB (H collection: hallmark gene sets).

References of tools
alakazam : Gupta N, Vander Heiden J, Uduman M, Gadala-Maria D, Yaari G, Kleinstein S (2015). Change-O: a toolkit for analyzing large-scale B cell immunoglobulin repertoire sequencing data. Bioinformatics, 1-3. doi: 10.1093/bioinformatics/btv359 (URL: https://doi.org/10.1093/bioinformatics/btv359).
BUStools : Pall Melsted, Vasilis Ntranos, Lior Pachter, The barcode, UMI, set format and BUStools, Bioinformatics, Volume 35, Issue 21, 1 November 2019, Pages 4472-4473, https://doi.org/10.1093/bioinformatics/btz279
Cerebro : Roman Hillje, Pier Giuseppe Pelicci, Lucilla Luzi, Cerebro: interactive visualization of scRNA-seq data, Bioinformatics, Volume 36, Issue 7, 1 April 2020, Pages 2311-2313, https://doi.org/10.1093/bioinformatics/btz877
ClustifyR : Fu R, Gillen A, Sheridan RM, Tian C, Daya M, Hao Y, Hesselberth JR, Riemondy KA (2019). clustifyr: An R package for automated single-cell RNA sequencing clusters classification. _F1000 Research_. doi:10.12688/f1000research.22969.1 (URL:https://doi.org/10.12688/f1000research.22969.1
clustree : Zappia L, Oshlack A. Clustering trees: a visualization for evaluating clusterings at multiple resolutions. GigaScience. 2018;7.DOI:gigascience/giy083.
fastq-screen : Wingett SW and Andrews S. FastQ Screen: A tool for multi-genome mapping and quality control [version 2; referees: 4 approved]. F1000Research 2018, 7:1338 (https://doi.org/10.12688/f1000research.15931.2)
kallisto : Nicolas L Bray, Harold Pimentel, Pall Melsted and Lior Pachter, Near-optimal probabilistic RNA-seq quantification, Nature Biotechnology 34, 525-527 (2016), doi:10.1038/nbt.3519
kb-python : Bray, N. L., Pimentel, H., Melsted, P., & Pachter, L. (2016). Near-optimal probabilistic RNA-seq quantification. Nature biotechnology, 34(5), 525 ; Melsted, P., Booeshaghi, A. S., Gao, F., da Veiga Beltrame, E., Lu, L., Hjorleifsson, K. E., Gehring, J., & Pachter, L. (2019). Modular and efficient pre-processing of single-cell RNA-seq. BioRxiv, 673285.
scRepertoire : Borcherding N and Bormann NL. scRepertoire: An R-based toolkit for single-cell immune receptor analysis [version 1; peer review: 2 approved with reservations]. F1000Research 2020, 9:47 (https://doi.org/10.12688/f1000research.22139.1)
Seurat : Butler, A., Hoffman, P., Smibert, P., Papalexi, E. & Satija, R. Integrating single-cell transcriptomic data across different conditions, technologies, and species. Nat. Biotechnol. 36, 411-420 (2018)
SingleR : Aran, Looney, Liu et al. Reference-based analysis of lung single-cell sequencing reveals a transitional profibrotic macrophage. Nature Immunology (2019)
